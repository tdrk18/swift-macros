name: Lint

on:
  pull_request:

jobs:
  swift-format-lint:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v6

      - name: Set up Homebrew
        uses: Homebrew/actions/setup-homebrew

      - name: Install swift-format
        run: brew install swift-format

      - name: Run swift-format lint
        run: |
          swift format lint --recursive . 2>&1 | while IFS= read -r line; do
            FILE=$(echo "$line" | cut -d: -f1)
            LINE=$(echo "$line" | cut -d: -f2)
            COL=$(echo "$line" | cut -d: -f3)
            TYPE=$(echo "$line" | cut -d: -f4 | xargs)
            MSG=$(echo "$line" | cut -d: -f5- | xargs)

            if [ "$TYPE" = "warning" ]; then
              echo "::warning file=$FILE,line=$LINE,col=$COL::$MSG"
            elif [ "$TYPE" = "error" ]; then
              echo "::error file=$FILE,line=$LINE,col=$COL::$MSG"
            else
              echo "::notice file=$FILE,line=$LINE,col=$COL::$MSG"
            fi
          done
